\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Machine Learning Analysis with Lagged Predictors},
            pdfauthor={Falco J. Bargagli-Stoffi, Massimo Riccaboni, Armando Rungi},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\providecommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Machine Learning Analysis with Lagged Predictors}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Falco J. Bargagli-Stoffi, Massimo Riccaboni, Armando Rungi}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{23/2/2020}


\begin{document}
\maketitle

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

This \texttt{R Markdown} file reproduces the lagged machine learning
analysis for the paper
\textit{"Machine learning for zombie hunting. Firms' failures, financial constraints, and misallocation"}
by Falco J. Bargagli-Stoffi (IMT School for Advanced Studies/KU Leuven),
Massimo Riccaboni (IMT School for Advanced Studies) and Armando Rungi
(IMT School for Advanced Studies).

\hypertarget{r-markdown}{%
\subsection{R Markdown}\label{r-markdown}}

This is an \texttt{R Markdown} document. Markdown is a simple formatting
syntax for authoring HTML, PDF, and MS Word documents. For more details
on using \texttt{R Markdown} see \url{http://rmarkdown.rstudio.com}.

When you click the \textbf{Knit} button a document will be generated
that includes both content as well as the output of any embedded
\texttt{R} code chunks within the document. You can embed an R code
chunks like the following.

\hypertarget{packages-upload}{%
\subsection{Packages Upload}\label{packages-upload}}

The following packages and functions are the ones used for the analyses
performed in the \texttt{R} code. The \texttt{functions.R} file contains
the functions \texttt{F1\_score}, \texttt{balanced\_accuracy},
\texttt{model\_compare} and \texttt{DtD} that were developed to
reproduce the following analyses.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rm}\NormalTok{(}\DataTypeTok{list=}\KeywordTok{ls}\NormalTok{()) }\CommentTok{# to clean the memeory}
\KeywordTok{memory.limit}\NormalTok{(}\DataTypeTok{size=}\DecValTok{1000000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1e+06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{java.parameters =} \StringTok{"-Xmx15000m"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(rJava)}
\KeywordTok{library}\NormalTok{(bartMachine)}
\KeywordTok{library}\NormalTok{(haven)}
\KeywordTok{library}\NormalTok{(plyr)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(PRROC)}
\KeywordTok{library}\NormalTok{(rpart)}
\KeywordTok{library}\NormalTok{(party)}
\KeywordTok{library}\NormalTok{(caret)}
\KeywordTok{library}\NormalTok{(Amelia)}
\KeywordTok{library}\NormalTok{(PresenceAbsence)}
\KeywordTok{library}\NormalTok{(devtools)}
\KeywordTok{library}\NormalTok{(SuperLearner)}
\KeywordTok{library}\NormalTok{(Metrics)}
\KeywordTok{library}\NormalTok{(pROC)}
\KeywordTok{library}\NormalTok{(Hmisc)}
\KeywordTok{source}\NormalTok{(}\StringTok{'functions.R'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-upload}{%
\subsection{Data Upload}\label{data-upload}}

In the following chunks of code we upload the data, we initialize the
main variables used in the analysis and we restrict the sample to the
Italian firms.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data <-}\StringTok{ }\KeywordTok{read_dta}\NormalTok{(}\StringTok{"analysis_data_indicators.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(data)[}\KeywordTok{names}\NormalTok{(data) }\OperatorTok{==}\StringTok{ 'GUO___BvD_ID_number'}\NormalTok{] <-}\StringTok{ 'guo'}
\NormalTok{data}\OperatorTok{$}\NormalTok{control <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(data}\OperatorTok{$}\NormalTok{guo}\OperatorTok{==}\StringTok{""}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{data}\OperatorTok{$}\NormalTok{nace <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{nace)}
\NormalTok{data}\OperatorTok{$}\NormalTok{area <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(data}\OperatorTok{$}\NormalTok{area)}
\KeywordTok{levels}\NormalTok{(data}\OperatorTok{$}\NormalTok{nace) <-}\StringTok{ }\KeywordTok{floor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{levels}\NormalTok{(data}\OperatorTok{$}\NormalTok{nace))}\OperatorTok{/}\DecValTok{100}\NormalTok{) }
\NormalTok{data_italy <-}\StringTok{ }\NormalTok{data[}\KeywordTok{which}\NormalTok{(data}\OperatorTok{$}\NormalTok{iso}\OperatorTok{==}\StringTok{"IT"}\NormalTok{),] }
\end{Highlighting}
\end{Shaded}

\hypertarget{explorative-data-analysis-eda}{%
\subsection{Explorative Data Analysis
(EDA)}\label{explorative-data-analysis-eda}}

Run the following chunks of code to produce Tables 1 in the paper.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{table_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{table}\NormalTok{(status_aggregated)}
\NormalTok{table_}\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## status_aggregated
##         Active     Bankruptcy      Dissolved In Liquidation 
##         287587           1533           8540           7221
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{prop.table}\NormalTok{(table_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## status_aggregated
##         Active     Bankruptcy      Dissolved In Liquidation 
##    0.943276229    0.005028191    0.028010929    0.023684651
\end{verbatim}

Run the following chunk of code to produce Table 8 in the paper.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(data}\OperatorTok{$}\NormalTok{iso)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##     ES     FR     IT     PT 
##  86979  74821 304906  41166
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{table_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data}\OperatorTok{$}\NormalTok{iso, data}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{table_}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     
##           0      1
##   ES  83639   3340
##   FR  70191   4630
##   IT 287587  17319
##   PT  38248   2918
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{prop.table}\NormalTok{(table_}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     
##               0          1
##   ES 0.96159993 0.03840007
##   FR 0.93811898 0.06188102
##   IT 0.94319889 0.05680111
##   PT 0.92911626 0.07088374
\end{verbatim}

Run the following chunks of code to produce Table 9 in the paper.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{icr_italy <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_italy}\OperatorTok{$}\NormalTok{ICR_failure)}
\KeywordTok{prop.table}\NormalTok{(icr_italy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7830209 0.2169791
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{icr_spain <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_spain}\OperatorTok{$}\NormalTok{ICR_failure)}
\KeywordTok{prop.table}\NormalTok{(icr_spain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7733839 0.2266161
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{icr_france <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_france}\OperatorTok{$}\NormalTok{ICR_failure)}
\KeywordTok{prop.table}\NormalTok{(icr_france)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7355627 0.2644373
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{icr_portugal <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_portugal}\OperatorTok{$}\NormalTok{ICR_failure)}
\KeywordTok{prop.table}\NormalTok{(icr_portugal)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7596578 0.2403422
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{neg_va_italy <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_italy}\OperatorTok{$}\NormalTok{NEG_VA)}
\KeywordTok{prop.table}\NormalTok{(neg_va_italy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.96555555 0.03444445
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{neg_va_spain <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_spain}\OperatorTok{$}\NormalTok{NEG_VA)}
\KeywordTok{prop.table}\NormalTok{(neg_va_spain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.9429404 0.0570596
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{neg_va_france <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_france}\OperatorTok{$}\NormalTok{NEG_VA)}
\KeywordTok{prop.table}\NormalTok{(neg_va_france)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.98668644 0.01331356
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{neg_va_portugal <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_portugal}\OperatorTok{$}\NormalTok{NEG_VA)}
\KeywordTok{prop.table}\NormalTok{(neg_va_portugal)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.96941531 0.03058469
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{interest_diff_italy <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_italy}\OperatorTok{$}\NormalTok{interest_diff)}
\KeywordTok{prop.table}\NormalTok{(interest_diff_italy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.5763131 0.4236869
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{interest_diff_spain <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_spain}\OperatorTok{$}\NormalTok{interest_diff)}
\KeywordTok{prop.table}\NormalTok{(interest_diff_spain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7468279 0.2531721
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{interest_diff_france <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_france}\OperatorTok{$}\NormalTok{interest_diff)}
\KeywordTok{prop.table}\NormalTok{(interest_diff_france)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7394369 0.2605631
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{interest_diff_portugal <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_portugal}\OperatorTok{$}\NormalTok{interest_diff)}
\KeywordTok{prop.table}\NormalTok{(interest_diff_portugal)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7437028 0.2562972
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{profitability_italy <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_italy}\OperatorTok{$}\NormalTok{profitability)}
\KeywordTok{prop.table}\NormalTok{(profitability_italy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.96418232 0.03581768
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{profitability_spain <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_spain}\OperatorTok{$}\NormalTok{profitability)}
\KeywordTok{prop.table}\NormalTok{(profitability_spain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.98663231 0.01336769
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{profitability_france <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_france}\OperatorTok{$}\NormalTok{profitability)}
\KeywordTok{prop.table}\NormalTok{(profitability_france)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.96267853 0.03732147
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{profitability_portugal <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_portugal}\OperatorTok{$}\NormalTok{profitability)}
\KeywordTok{prop.table}\NormalTok{(profitability_portugal)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.93905444 0.06094556
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{misallocated_fixed_italy <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_italy}\OperatorTok{$}\NormalTok{misallocated_fixed)}
\KeywordTok{prop.table}\NormalTok{(misallocated_fixed_italy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.8794937 0.1205063
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{misallocated_fixed_spain <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_spain}\OperatorTok{$}\NormalTok{misallocated_fixed)}
\KeywordTok{prop.table}\NormalTok{(misallocated_fixed_spain)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##          0          1 
## 0.97075506 0.02924494
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{misallocated_fixed_france <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_france}\OperatorTok{$}\NormalTok{misallocated_fixed)}
\KeywordTok{prop.table}\NormalTok{(misallocated_fixed_france)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.8888808 0.1111192
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{misallocated_fixed_portugal <-}\StringTok{ }\KeywordTok{table}\NormalTok{(data_portugal}\OperatorTok{$}\NormalTok{misallocated_fixed)}
\KeywordTok{prop.table}\NormalTok{(misallocated_fixed_portugal)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##         0         1 
## 0.7938577 0.2061423
\end{verbatim}

Run the following code to explore the missingness patterns in the
variables.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Missingness in the variables}
\KeywordTok{sapply}\NormalTok{(data_italy,}\ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{sum}\NormalTok{(}\KeywordTok{is.na}\NormalTok{(x)))}
\end{Highlighting}
\end{Shaded}


Exclude the highly missing variables:
\textit{labour\_product, retained\_earnings, firm\_value, tax\_payables, pension\_payables, pension\_tax\_debts}
(above 200,000 missing: +65\% missing).

Run the following code to reproduce the ``missingness maps'' in Figures
1 and 2 of the paper.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{raw_variables <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"failure"}\NormalTok{, }\StringTok{"iso"}\NormalTok{, }\StringTok{"control"}\NormalTok{, }\StringTok{"Number_of_patents"}\NormalTok{,}
                   \StringTok{"Number_of_trademarks"}\NormalTok{, }\StringTok{"conscode"}\NormalTok{, }\StringTok{"nace"}\NormalTok{,}
                   \StringTok{"wage_bill"}\NormalTok{,}\StringTok{"shareholders_funds"}\NormalTok{, }\StringTok{"added_value"}\NormalTok{,}
                   \StringTok{"cash_flow"}\NormalTok{, }\StringTok{"ebitda"}\NormalTok{, }\StringTok{"fin_rev"}\NormalTok{, }\StringTok{"liquidity_ratio"}\NormalTok{,}
                   \StringTok{"total_assets"}\NormalTok{, }\StringTok{"depr"}\NormalTok{, }\StringTok{"long_term_debt"}\NormalTok{, }\StringTok{"employees"}\NormalTok{,}
                   \StringTok{"materials"}\NormalTok{, }\StringTok{"loans"}\NormalTok{, }\StringTok{"fixed_assets"}\NormalTok{, }\StringTok{"tax"}\NormalTok{,}
                   \StringTok{"current_liabilities"}\NormalTok{, }\StringTok{"current_assets"}\NormalTok{, }
                   \StringTok{"fin_expenses"}\NormalTok{, }\StringTok{"int_paid"}\NormalTok{, }\StringTok{"solvency_ratio"}\NormalTok{,}
                   \StringTok{"net_income"}\NormalTok{, }\StringTok{"revenue"}\NormalTok{, }\StringTok{"int_fixed_assets"}\NormalTok{) }
\NormalTok{raw_data_missing <-}\StringTok{ }\NormalTok{data_italy[raw_variables]}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{sample_}\DecValTok{1000}\NormalTok{ <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(raw_data_missing),}
                      \DecValTok{1000}\NormalTok{, }\DataTypeTok{replace =} \OtherTok{FALSE}\NormalTok{)}
\KeywordTok{pdf}\NormalTok{(}\StringTok{"missing_variables.pdf"}\NormalTok{) }
\KeywordTok{missmap}\NormalTok{(raw_data_missing[sample_}\DecValTok{1000}\NormalTok{,],}
        \DataTypeTok{main =} \StringTok{"Missing values vs Observed"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in if (class(obj) == "amelia") {: la condizione la lunghezza > 1 e
## solo il promo elemento verrÃ  utilizzato
\end{verbatim}

\begin{verbatim}
## Warning: Unknown or uninitialised column: 'arguments'.

## Warning: Unknown or uninitialised column: 'arguments'.
\end{verbatim}

\begin{verbatim}
## Warning: Unknown or uninitialised column: 'imputations'.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## pdf 
##   2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{indicators <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"consdummy"}\NormalTok{, }\StringTok{"capital_intensity"}\NormalTok{, }\StringTok{"fin_cons100"}\NormalTok{,}
                \StringTok{"inv"}\NormalTok{, }\StringTok{"ICR_failure"}\NormalTok{, }\StringTok{"interest_diff"}\NormalTok{, }\StringTok{"NEG_VA"}\NormalTok{,}
                \StringTok{"real_SA"}\NormalTok{, }\StringTok{"Z_score"}\NormalTok{, }\StringTok{"misallocated_fixed"}\NormalTok{,}
                \StringTok{"profitability"}\NormalTok{, }\StringTok{"area"}\NormalTok{, }\StringTok{"tfp_acf"}\NormalTok{, }\StringTok{"dummy_patents"}\NormalTok{,}
                \StringTok{"dummy_trademark"}\NormalTok{, }\StringTok{"financial_sustainability"}\NormalTok{,}
                \StringTok{"liquidity_return"}\NormalTok{) }
\NormalTok{indicators_missing <-}\StringTok{ }\NormalTok{data_italy[indicators]}
\KeywordTok{pdf}\NormalTok{(}\StringTok{"missing_indicators.pdf"}\NormalTok{) }
\KeywordTok{missmap}\NormalTok{(indicators_missing[sample_}\DecValTok{1000}\NormalTok{,],}
        \DataTypeTok{main =} \StringTok{"Missing values vs Observed"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in if (class(obj) == "amelia") {: la condizione la lunghezza > 1 e
## solo il promo elemento verrÃ  utilizzato
\end{verbatim}

\begin{verbatim}
## Warning: Unknown or uninitialised column: 'arguments'.

## Warning: Unknown or uninitialised column: 'arguments'.
\end{verbatim}

\begin{verbatim}
## Warning: Unknown or uninitialised column: 'imputations'.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## pdf 
##   2
\end{verbatim}

\hypertarget{machine-learning-analysis}{%
\section{Machine Learning Analysis}\label{machine-learning-analysis}}

\hypertarget{data-inizialization}{%
\subsection{Data Inizialization}\label{data-inizialization}}

Select the lagged variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lagged_variables <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"failure"}\NormalTok{, }\StringTok{"iso"}\NormalTok{, }\StringTok{"control"}\NormalTok{, }\StringTok{"nace"}\NormalTok{,}
                      \StringTok{"shareholders_funds"}\NormalTok{, }\StringTok{"added_value"}\NormalTok{,}
                      \StringTok{"cash_flow"}\NormalTok{, }\StringTok{"ebitda"}\NormalTok{, }\StringTok{"fin_rev"}\NormalTok{,}
                      \StringTok{"liquidity_ratio"}\NormalTok{, }\StringTok{"total_assets"}\NormalTok{,}
                      \StringTok{"depr"}\NormalTok{, }\StringTok{"long_term_debt"}\NormalTok{, }\StringTok{"employees"}\NormalTok{,}
                      \StringTok{"materials"}\NormalTok{, }\StringTok{"loans"}\NormalTok{, }\StringTok{"wage_bill"}\NormalTok{,}
                      \StringTok{"tfp_acf"}\NormalTok{, }\StringTok{"fixed_assets"}\NormalTok{, }\StringTok{"tax"}\NormalTok{,}
                      \StringTok{"current_liabilities"}\NormalTok{, }\StringTok{"current_assets"}\NormalTok{,}
                      \StringTok{"fin_expenses"}\NormalTok{, }\StringTok{"int_paid"}\NormalTok{,}
                      \StringTok{"solvency_ratio"}\NormalTok{, }\StringTok{"net_income"}\NormalTok{,}
                      \StringTok{"revenue"}\NormalTok{, }\StringTok{"consdummy"}\NormalTok{, }\StringTok{"capital_intensity"}\NormalTok{,}
                      \StringTok{"fin_cons100"}\NormalTok{, }\StringTok{"inv"}\NormalTok{, }\StringTok{"ICR_failure"}\NormalTok{,}
                      \StringTok{"interest_diff"}\NormalTok{, }\StringTok{"NEG_VA"}\NormalTok{, }\StringTok{"real_SA"}\NormalTok{,}
                      \StringTok{"Z_score"}\NormalTok{, }\StringTok{"misallocated_fixed"}\NormalTok{,}
                      \StringTok{"profitability"}\NormalTok{, }\StringTok{"area"}\NormalTok{, }\StringTok{"dummy_patents"}\NormalTok{,}
                      \StringTok{"dummy_trademark"}\NormalTok{,}\StringTok{"financial_sustainability"}\NormalTok{,}
                      \StringTok{"liquidity_return"}\NormalTok{, }\StringTok{"int_fixed_assets"}\NormalTok{)}
\NormalTok{data_lagged <-}\StringTok{ }\NormalTok{data_italy[lagged_variables]}
\end{Highlighting}
\end{Shaded}

Select the predictors.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{predictors <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"control"}\NormalTok{, }\StringTok{"nace"}\NormalTok{, }\StringTok{"shareholders_funds"}\NormalTok{,}
                \StringTok{"added_value"}\NormalTok{, }\StringTok{"cash_flow"}\NormalTok{, }\StringTok{"ebitda"}\NormalTok{,}
                \StringTok{"fin_rev"}\NormalTok{, }\StringTok{"liquidity_ratio"}\NormalTok{, }\StringTok{"total_assets"}\NormalTok{,}
                \StringTok{"depr"}\NormalTok{, }\StringTok{"long_term_debt"}\NormalTok{, }\StringTok{"employees"}\NormalTok{,}
                \StringTok{"materials"}\NormalTok{, }\StringTok{"loans"}\NormalTok{, }\StringTok{"wage_bill"}\NormalTok{, }\StringTok{"tfp_acf"}\NormalTok{,}
                \StringTok{"fixed_assets"}\NormalTok{, }\StringTok{"tax"}\NormalTok{, }\StringTok{"current_liabilities"}\NormalTok{,}
                \StringTok{"current_assets"}\NormalTok{, }\StringTok{"fin_expenses"}\NormalTok{, }\StringTok{"int_paid"}\NormalTok{,}
                \StringTok{"solvency_ratio"}\NormalTok{, }\StringTok{"net_income"}\NormalTok{, }\StringTok{"revenue"}\NormalTok{,}
                \StringTok{"consdummy"}\NormalTok{, }\StringTok{"capital_intensity"}\NormalTok{, }\StringTok{"fin_cons100"}\NormalTok{,}
                \StringTok{"inv"}\NormalTok{, }\StringTok{"ICR_failure"}\NormalTok{, }\StringTok{"interest_diff"}\NormalTok{, }\StringTok{"NEG_VA"}\NormalTok{,}
                \StringTok{"real_SA"}\NormalTok{, }\StringTok{"misallocated_fixed"}\NormalTok{, }\StringTok{"profitability"}\NormalTok{,}
                \StringTok{"area"}\NormalTok{, }\StringTok{"dummy_patents"}\NormalTok{, }\StringTok{"dummy_trademark"}\NormalTok{,}
                \StringTok{"financial_sustainability"}\NormalTok{, }\StringTok{"liquidity_return"}\NormalTok{,}
                \StringTok{"int_fixed_assets"}\NormalTok{)}
\NormalTok{formula <-}\StringTok{ }\KeywordTok{as.formula}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"as.factor(failure) ~"}\NormalTok{,}
                            \KeywordTok{paste}\NormalTok{(predictors, }\DataTypeTok{collapse=}\StringTok{"+"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

Create training and testing sets by assigning 90\% of the observations
to the training set and 10\% to the testing set.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{omitted <-}\StringTok{ }\KeywordTok{na.omit}\NormalTok{(data_lagged)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{index <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{seq_len}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(omitted)), }\DataTypeTok{size =} \KeywordTok{nrow}\NormalTok{(omitted)}\OperatorTok{*}\FloatTok{0.9}\NormalTok{) }
\NormalTok{train <-}\StringTok{ }\NormalTok{omitted[index,]}
\NormalTok{test <-}\StringTok{ }\NormalTok{omitted[}\OperatorTok{-}\NormalTok{index,]}
\end{Highlighting}
\end{Shaded}

\hypertarget{logit}{%
\subsection{Logit}\label{logit}}

Run a Logistic regression analysis.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system.time}\NormalTok{(\{}
\NormalTok{logit <-}\StringTok{ }\KeywordTok{glm}\NormalTok{(formula, }\DataTypeTok{data=}\NormalTok{ train,  }\DataTypeTok{na.action =} \StringTok{"na.omit"}\NormalTok{,}
             \DataTypeTok{family=}\KeywordTok{binomial}\NormalTok{(}\DataTypeTok{link=}\StringTok{'logit'}\NormalTok{))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    user  system elapsed 
##    6.97    0.32    9.56
\end{verbatim}

Depict the performance measures by running the following chunks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.prob.logit <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(logit, }\DataTypeTok{newdata=}\NormalTok{test, }\DataTypeTok{type=}\StringTok{'response'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.logit <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(fitted.prob.logit)}
\NormalTok{fg.logit <-}\StringTok{ }\NormalTok{fitted.logit[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{1}\NormalTok{]}
\NormalTok{bg.logit <-}\StringTok{ }\NormalTok{fitted.logit[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc_logit <-}\StringTok{ }\KeywordTok{roc.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.logit,}
                       \DataTypeTok{scores.class1 =}\NormalTok{ bg.logit,}
                       \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(roc_logit)}
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-22-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pr_logit <-}\StringTok{ }\KeywordTok{pr.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.logit,}
                     \DataTypeTok{scores.class1 =}\NormalTok{ bg.logit,}
                     \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(pr_logit) }
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-23-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.logit <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(fitted.prob.logit}\OperatorTok{>}\FloatTok{0.5}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{)}
\NormalTok{f1_logit <-}\StringTok{ }\KeywordTok{f1_score}\NormalTok{(fitted.logit,}
\NormalTok{                     test}\OperatorTok{$}\NormalTok{failure,}
                     \DataTypeTok{positive.class=}\StringTok{"1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{balanced_accuracy_logit<-}\KeywordTok{balanced_accuracy}\NormalTok{(fitted.logit, test}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{accuracy_logit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{postResample}\NormalTok{(fitted.logit,}
\NormalTok{                                                   test}\OperatorTok{$}\NormalTok{failure)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logit_fit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(roc_logit}\OperatorTok{$}\NormalTok{auc,}
\NormalTok{                                 pr_logit}\OperatorTok{$}\NormalTok{auc.integral,}
\NormalTok{                                 f1_logit,}
\NormalTok{                                 balanced_accuracy_logit,}
\NormalTok{                                 accuracy_logit}\OperatorTok{$}\NormalTok{Rsquared))}
\KeywordTok{colnames}\NormalTok{(logit_fit) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AUC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{, }\StringTok{"f1-score"}\NormalTok{, }\StringTok{"BACC"}\NormalTok{, }\StringTok{"Rsquared"}\NormalTok{)}
\NormalTok{logit_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         AUC        PR  f1-score      BACC   Rsquared
## 1 0.8896212 0.3575797 0.2098214 0.8433113 0.08287033
\end{verbatim}

\hypertarget{classification-tree}{%
\subsection{Classification Tree}\label{classification-tree}}

Run a classification tree analysis.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\KeywordTok{system.time}\NormalTok{(\{}
\NormalTok{c.tree <-}\StringTok{ }\KeywordTok{ctree}\NormalTok{(formula, }\DataTypeTok{data=}\NormalTok{train,}
               \DataTypeTok{control =} \KeywordTok{ctree_control}\NormalTok{(}\DataTypeTok{testtype =} \StringTok{"MonteCarlo"}\NormalTok{,}
               \DataTypeTok{mincriterion =} \FloatTok{0.90}\NormalTok{, }\DataTypeTok{nresample =} \DecValTok{1000}\NormalTok{))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    user  system elapsed 
##  402.23    0.85  411.26
\end{verbatim}

Depict the performance measures by running the following chunks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.results.tree <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(}\KeywordTok{predict}\NormalTok{(c.tree,}
                                 \DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type=}\StringTok{'prob'}\NormalTok{)))}
\NormalTok{fitted.prob.tree <-}\StringTok{ }\NormalTok{fitted.results.tree[}\KeywordTok{seq_along}\NormalTok{(fitted.results.tree) }\OperatorTok{%%}\DecValTok{2} \OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Roc}
\NormalTok{fg.tree<-fitted.prob.tree[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{1}\NormalTok{]}
\NormalTok{bg.tree<-fitted.prob.tree[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc_ctree <-}\StringTok{ }\KeywordTok{roc.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.tree,}
                       \DataTypeTok{scores.class1 =}\NormalTok{ bg.tree,}
                       \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(roc_ctree) }
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-30-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pr_ctree <-}\StringTok{ }\KeywordTok{pr.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.tree,}
                     \DataTypeTok{scores.class1 =}\NormalTok{ bg.tree,}
                     \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(pr_ctree) }
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-31-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.ctree <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(c.tree,}
                        \DataTypeTok{newdata =}\NormalTok{ test,}
                        \DataTypeTok{type=}\StringTok{'response'}\NormalTok{)}
\NormalTok{f1_ctree <-}\StringTok{ }\KeywordTok{f1_score}\NormalTok{(fitted.ctree,}
\NormalTok{                     test}\OperatorTok{$}\NormalTok{failure,}
                     \DataTypeTok{positive.class=}\StringTok{"1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{balanced_accuracy_ctree <-}\StringTok{ }\KeywordTok{balanced_accuracy}\NormalTok{(fitted.ctree, test}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{accuracy_ctree <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{postResample}\NormalTok{(}\KeywordTok{as.double}\NormalTok{(fitted.ctree), test}\OperatorTok{$}\NormalTok{failure)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ctree_fit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(roc_ctree}\OperatorTok{$}\NormalTok{auc,}
\NormalTok{                                 pr_ctree}\OperatorTok{$}\NormalTok{auc.integral,}
\NormalTok{                                 f1_ctree,}
\NormalTok{                                 balanced_accuracy_ctree,}
\NormalTok{                                 accuracy_ctree}\OperatorTok{$}\NormalTok{Rsquared))}
\KeywordTok{colnames}\NormalTok{(ctree_fit) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AUC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{, }\StringTok{"f1-score"}\NormalTok{, }\StringTok{"BACC"}\NormalTok{, }\StringTok{"Rsquared"}\NormalTok{)}
\NormalTok{ctree_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         AUC        PR f1-score     BACC   Rsquared
## 1 0.8889458 0.3568026      0.2 0.780396 0.06540008
\end{verbatim}

\hypertarget{random-forest}{%
\subsection{Random Forest}\label{random-forest}}

Run a Random Forest analysis.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}

\KeywordTok{system.time}\NormalTok{(\{}
\NormalTok{rf <-}\StringTok{ }\KeywordTok{randomForest}\NormalTok{(formula, }\DataTypeTok{data=}\NormalTok{train,}
                   \DataTypeTok{importance =} \OtherTok{FALSE}\NormalTok{,}
                   \DataTypeTok{ntree=}\DecValTok{200}\NormalTok{)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    user  system elapsed 
##  204.77    0.83  208.34
\end{verbatim}

Depict the performance measures by running the following chunks.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Fitted results Random Forest}
\NormalTok{fitted.prob.rf <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf, }\DataTypeTok{newdata=}\NormalTok{test, }\DataTypeTok{type=}\StringTok{'prob'}\NormalTok{) }
\NormalTok{fitted.prob.rf <-}\StringTok{ }\NormalTok{fitted.prob.rf[,}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Roc}
\NormalTok{fg.rf<-fitted.prob.rf[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{1}\NormalTok{]}
\NormalTok{bg.rf<-fitted.prob.rf[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc_rf <-}\StringTok{ }\KeywordTok{roc.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.rf,}
                    \DataTypeTok{scores.class1 =}\NormalTok{ bg.rf,}
                    \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(roc_rf)}
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-38-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pr_rf<-}\KeywordTok{pr.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.rf,}
                \DataTypeTok{scores.class1 =}\NormalTok{ bg.rf,}
                \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(pr_rf)}
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-39-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.rf <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(fitted.prob.rf }\OperatorTok{>}\StringTok{ }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{f1_rf <-}\StringTok{ }\KeywordTok{f1_score}\NormalTok{(fitted.rf,}
\NormalTok{                  test}\OperatorTok{$}\NormalTok{failure,}
                  \DataTypeTok{positive.class=}\StringTok{"1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{balanced_accuracy_rf <-}\StringTok{ }\KeywordTok{balanced_accuracy}\NormalTok{(fitted.rf, test}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{accuracy_rf <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{postResample}\NormalTok{(}\KeywordTok{as.double}\NormalTok{(fitted.rf),}
\NormalTok{                                                      test}\OperatorTok{$}\NormalTok{failure)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_fit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(roc_rf}\OperatorTok{$}\NormalTok{auc,}
\NormalTok{                              pr_rf}\OperatorTok{$}\NormalTok{auc.integral,}
\NormalTok{                              f1_rf, balanced_accuracy_rf,}
\NormalTok{                              accuracy_rf}\OperatorTok{$}\NormalTok{Rsquared))}
\KeywordTok{colnames}\NormalTok{(rf_fit) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AUC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{, }\StringTok{"f1-score"}\NormalTok{, }\StringTok{"BACC"}\NormalTok{, }\StringTok{"Rsquared"}\NormalTok{)}
\NormalTok{rf_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         AUC        PR  f1-score      BACC   Rsquared
## 1 0.9050392 0.4262259 0.2256637 0.8515472 0.09220139
\end{verbatim}

\hypertarget{super-learner}{%
\subsection{Super Learner}\label{super-learner}}

Run a super learner analysis, by using an ensemble method with three
learners: a logistic regression, a classification tree and a random
forest.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SL.library <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"SL.glm"}\NormalTok{,  }\StringTok{"SL.randomForest"}\NormalTok{, }\StringTok{"SL.rpartPrune"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train}\OperatorTok{$}\NormalTok{X <-(train[predictors])}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\KeywordTok{system.time}\NormalTok{(\{}
\NormalTok{  SL <-}\StringTok{ }\KeywordTok{SuperLearner}\NormalTok{(}\DataTypeTok{Y=}\NormalTok{train}\OperatorTok{$}\NormalTok{failure, }\DataTypeTok{X=}\NormalTok{train}\OperatorTok{$}\NormalTok{X,}
                     \DataTypeTok{SL.library =}\NormalTok{ SL.library,}
                     \DataTypeTok{verbose =} \OtherTok{FALSE}\NormalTok{,}
                     \DataTypeTok{method =} \StringTok{"method.NNLS"}\NormalTok{,}
                     \DataTypeTok{family =} \KeywordTok{binomial}\NormalTok{())}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     user   system  elapsed 
## 11308.47   385.36 12721.22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(SL)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          SL.glm_All SL.randomForest_All   SL.rpartPrune_All 
##          0.18903816          0.78628692          0.02467493
\end{verbatim}

Depict the performance measures by running the following chunks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test}\OperatorTok{$}\NormalTok{X <-(test[predictors])}
\NormalTok{sl.fitted <-}\StringTok{ }\KeywordTok{predict.SuperLearner}\NormalTok{(SL, test}\OperatorTok{$}\NormalTok{X,}
                                  \DataTypeTok{X =}\NormalTok{ train}\OperatorTok{$}\NormalTok{X,}
                                  \DataTypeTok{Y =}\NormalTok{ train}\OperatorTok{$}\NormalTok{failure,}
                                  \DataTypeTok{onlySL =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Roc}
\NormalTok{fg.sl<-sl.fitted}\OperatorTok{$}\NormalTok{pred[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{1}\NormalTok{] }
\NormalTok{bg.sl<-sl.fitted}\OperatorTok{$}\NormalTok{pred[test}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc_sl<-}\KeywordTok{roc.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.sl,}
                  \DataTypeTok{scores.class1 =}\NormalTok{ bg.sl,}
                  \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(roc_sl) }
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-47-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pr_sl<-}\KeywordTok{pr.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.sl,}
                \DataTypeTok{scores.class1 =}\NormalTok{ bg.sl,}
                \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(pr_sl)}
\end{Highlighting}
\end{Shaded}

\includegraphics{lagged_analyses_files/figure-latex/unnamed-chunk-48-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.sl <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(sl.fitted}\OperatorTok{$}\NormalTok{pred }\OperatorTok{>}\StringTok{ }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{f1_sl <-}\StringTok{ }\KeywordTok{f1_score}\NormalTok{(fitted.sl,}
\NormalTok{                  test}\OperatorTok{$}\NormalTok{failure,}
                  \DataTypeTok{positive.class=}\StringTok{"1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{balanced_accuracy_sl <-}\StringTok{ }\KeywordTok{balanced_accuracy}\NormalTok{(fitted.sl, test}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{accuracy_sl <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{postResample}\NormalTok{(}\KeywordTok{as.double}\NormalTok{(fitted.sl),}
\NormalTok{                                                      test}\OperatorTok{$}\NormalTok{failure)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sl_fit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(roc_sl}\OperatorTok{$}\NormalTok{auc,}
\NormalTok{                              pr_sl}\OperatorTok{$}\NormalTok{auc.integral,}
\NormalTok{                              f1_sl,}
\NormalTok{                              balanced_accuracy_sl,}
\NormalTok{                              accuracy_sl}\OperatorTok{$}\NormalTok{Rsquared))}
\KeywordTok{colnames}\NormalTok{(sl_fit) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AUC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{, }\StringTok{"f1-score"}\NormalTok{, }\StringTok{"BACC"}\NormalTok{, }\StringTok{"Rsquared"}\NormalTok{)}
\NormalTok{sl_fit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        AUC        PR  f1-score      BACC  Rsquared
## 1 0.907256 0.4310831 0.2232143 0.8665509 0.0944695
\end{verbatim}

\hypertarget{bart-mia}{%
\subsection{BART-mia}\label{bart-mia}}

Run a Bayesian Additive Regression Tree analysis by using the overall
data sample (no need to omit the observations with missing values).

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{sample <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{seq_len}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(data_italy)),}
                 \DataTypeTok{size =} \KeywordTok{nrow}\NormalTok{(omitted),}
                 \DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{) }
\NormalTok{data_italy_bart <-}\StringTok{ }\NormalTok{data_italy[sample,]}
\end{Highlighting}
\end{Shaded}

Select the same number of observations as in the previous models for the
training and testing samples.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{2020}\NormalTok{)}
\NormalTok{train_sample <-}\StringTok{ }\KeywordTok{sample}\NormalTok{(}\KeywordTok{seq_len}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(data_italy_bart)),}
                       \DataTypeTok{size =} \KeywordTok{nrow}\NormalTok{(data_italy_bart )}\OperatorTok{*}\FloatTok{0.9}\NormalTok{, }\DataTypeTok{replace=}\OtherTok{FALSE}\NormalTok{) }
\NormalTok{train_bart <-}\StringTok{ }\NormalTok{data_italy_bart[train_sample,]}
\NormalTok{test_bart <-}\StringTok{ }\NormalTok{data_italy_bart[}\OperatorTok{-}\NormalTok{train_sample,]}
\NormalTok{train_bart}\OperatorTok{$}\NormalTok{X <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(train_bart[predictors])}
\NormalTok{test_bart}\OperatorTok{$}\NormalTok{X <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(test_bart[predictors])}
\end{Highlighting}
\end{Shaded}

Run the analysis.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system.time}\NormalTok{(\{}
\NormalTok{bart_machine<-}\KeywordTok{bartMachine}\NormalTok{(train_bart}\OperatorTok{$}\NormalTok{X,}
                          \KeywordTok{as.factor}\NormalTok{(train_bart}\OperatorTok{$}\NormalTok{failure),}
                          \DataTypeTok{use_missing_data=}\OtherTok{TRUE}\NormalTok{) }
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Depict the performance measures by running the following chunks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitted.results.bart <-}\StringTok{ }\DecValTok{1}\OperatorTok{-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{predict}\NormalTok{(bart_machine,}
\NormalTok{                                        test_bart}\OperatorTok{$}\NormalTok{X,}
                                        \DataTypeTok{type=}\StringTok{'prob'}\NormalTok{), }\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Roc}
\NormalTok{fg.bart<-fitted.results.bart[test_bart}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{1}\NormalTok{] }
\NormalTok{bg.bart<-fitted.results.bart[test_bart}\OperatorTok{$}\NormalTok{failure}\OperatorTok{==}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{G:/Il mio Drive/Research/Italian Firms/Zombie Hunting New Data/roc_bart.jpg}
\caption{Area under the ROC curve, BART}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc_bart<-}\KeywordTok{roc.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.bart,}
                    \DataTypeTok{scores.class1 =}\NormalTok{ bg.bart,}
                    \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(roc_bart)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{G:/Il mio Drive/Research/Italian Firms/Zombie Hunting New Data/pr_bart.jpg}
\caption{Area under the PR curve, BART}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pr_bart<-}\KeywordTok{pr.curve}\NormalTok{(}\DataTypeTok{scores.class0 =}\NormalTok{ fg.bart,}
                  \DataTypeTok{scores.class1 =}\NormalTok{ bg.bart,}
                  \DataTypeTok{curve =}\NormalTok{ T)}
\KeywordTok{plot}\NormalTok{(pr_bart)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Get Accurancy}
\NormalTok{fitted.bart <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(fitted.results.bart}\OperatorTok{>}\StringTok{ }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{f1_bart <-}\StringTok{ }\KeywordTok{f1_score}\NormalTok{(fitted.bart,}
\NormalTok{                    test_bart}\OperatorTok{$}\NormalTok{failure,}
                    \DataTypeTok{positive.class=}\StringTok{"1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{balanced_accuracy_bart <-}\StringTok{ }\KeywordTok{balanced_accuracy}\NormalTok{(fitted.bart, test_bart}\OperatorTok{$}\NormalTok{failure)}
\NormalTok{accuracy_bart <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{rbind}\NormalTok{(}\KeywordTok{postResample}\NormalTok{(}\KeywordTok{as.double}\NormalTok{(fitted.bart),}
\NormalTok{                                                    test_bart}\OperatorTok{$}\NormalTok{failure)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bart_fit <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(roc_bart}\OperatorTok{$}\NormalTok{auc,}
\NormalTok{                                pr_bart}\OperatorTok{$}\NormalTok{auc.integral,}
\NormalTok{                                f1_bart,}
\NormalTok{                                balanced_accuracy_bart,}
\NormalTok{                                accuracy_bart}\OperatorTok{$}\NormalTok{Rsquared))}
\KeywordTok{colnames}\NormalTok{(bart_fit) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"AUC"}\NormalTok{, }\StringTok{"PR"}\NormalTok{, }\StringTok{"f1-score"}\NormalTok{, }\StringTok{"BACC"}\NormalTok{, }\StringTok{"Rsquared"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{save-results}{%
\subsection{Save Results}\label{save-results}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model_results <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(logit_fit, ctree_fit, rf_fit, sl_fit, bart_fit)}
\KeywordTok{write.csv}\NormalTok{(model_results, }\DataTypeTok{file =} \StringTok{"model_results.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{model-comparison}{%
\section{Model Comparison}\label{model-comparison}}

Here, we run an empirical horse race where we define two competitors
(benchmark or ``usual methods'') and we compare them with our preferred
BART methodology. Natural candidates are ``default probability
predictors'' (credit-ratings type of measures) such as:

\begin{enumerate}
\item  Altman Z-score;
\item  Distance-to-Default.
\end{enumerate}

As these measures do not provide direct predictions for failed firms, we
create a series of dummy variables in the following way:
\begin{equation}
        Z-dummy_i=\begin{cases}
        1 &  \text{if $Z-score_i \leq q$}, \nonumber \\
        0 &   \text{otherwise}
        \end{cases}
\end{equation} and \begin{equation}
        DtD-dummy_i=\begin{cases}
        1 &  \text{if $DtD_i \leq q$}, \nonumber \\
        0 &   \text{otherwise}
        \end{cases}
\end{equation} where \(q\) is the 1st to 10th percentile distribution of
the Z-score and the DtD measures, respectively.

By doing so, we assume to be predicted as ``failed'', those observations
with values on the left tails of the Z and DtD measures.

We create these variables on the testing set and then we compare their
performance, in terms of precision and false discovery rate (FDR), with
the one of BART.

\hypertarget{z-score}{%
\subsection{Z-score}\label{z-score}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{precision_bart <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{t}\NormalTok{(}\KeywordTok{model_compare}\NormalTok{(fitted.bart,}
\NormalTok{                                  test_bart}\OperatorTok{$}\NormalTok{failure, }\StringTok{"1"}\NormalTok{)))}
\KeywordTok{colnames}\NormalTok{(precision_bart) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Precision BART"}\NormalTok{, }\StringTok{"FDR BART"}\NormalTok{)}
\KeywordTok{write.csv}\NormalTok{(precision_bart, }\StringTok{"precision_and_fdr_bart.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{seq <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{precision_zscore <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =} \KeywordTok{length}\NormalTok{(seq))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ seq) \{}
\NormalTok{  failed_zscore <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(test}\OperatorTok{$}\NormalTok{Z_score }\OperatorTok{<=}\StringTok{ }\KeywordTok{quantile}\NormalTok{(test}\OperatorTok{$}\NormalTok{Z_score, i}\OperatorTok{/}\DecValTok{100}\NormalTok{),}
                                                                  \DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{  precision_zscore[i, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)] <-}\StringTok{ }\KeywordTok{t}\NormalTok{(}\KeywordTok{model_compare}\NormalTok{(failed_zscore,}
\NormalTok{                                                 test}\OperatorTok{$}\NormalTok{failure, }\StringTok{"1"}\NormalTok{))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{mertons-distance-to-default-dtd}{%
\subsection{Merton's Distance-to-Default
(DtD)}\label{mertons-distance-to-default-dtd}}

The average equity volatility in the considered time series is 27.9120
(Bank of Italy), while for the average risk free interest rate we use
the long term government bond yields" EMU (Eurostat) that has a value of
4.2937.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dtd_score <-}\StringTok{ }\KeywordTok{DtD}\NormalTok{(}\DataTypeTok{mcap =}\NormalTok{ test}\OperatorTok{$}\NormalTok{shareholders_funds, }\DataTypeTok{debt =}\NormalTok{ test}\OperatorTok{$}\NormalTok{long_term_debt, }\DataTypeTok{vol =} \FloatTok{27.9120}\NormalTok{, }\DataTypeTok{r =} \FloatTok{4.2937}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{seq <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{precision_dtd_score <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{2}\NormalTok{, }\DataTypeTok{nrow =} \KeywordTok{length}\NormalTok{(seq))}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ seq) \{}
\NormalTok{  failed_dtd_score <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(dtd_score }\OperatorTok{<=}\StringTok{ }\KeywordTok{quantile}\NormalTok{(dtd_score, i}\OperatorTok{/}\DecValTok{100}\NormalTok{), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{  precision_dtd_score[i, }\KeywordTok{c}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)] <-}\StringTok{ }\KeywordTok{t}\NormalTok{(}\KeywordTok{model_compare}\NormalTok{(failed_dtd_score,}
\NormalTok{                                                    test}\OperatorTok{$}\NormalTok{failure, }\StringTok{"1"}\NormalTok{))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{precision_models <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(precision_dtd_score, precision_zscore))}
\KeywordTok{colnames}\NormalTok{(precision_models) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Precision DtD"}\NormalTok{,}
                                \StringTok{"FDR DtD"}\NormalTok{,}
                                \StringTok{"Precision Z-score"}\NormalTok{,}
                                \StringTok{"FDR Z-score"}\NormalTok{)}
\KeywordTok{write.csv}\NormalTok{(precision_models, }\StringTok{"precision_and_fdr_scores.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}


\end{document}
